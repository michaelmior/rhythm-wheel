(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,r){e.exports=r(30)},18:function(e,t,r){},27:function(e,t,r){},28:function(e,t,r){},29:function(e,t,r){},30:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(11),s=r.n(a),o=(r(18),r(12)),u=r.n(o),c=r(8),l=r(1),d=r(2),p=r(4),h=r(3),m=r(5),f=r(7),y=r.n(f),v=r(6),b=(r(27),function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"Circle",style:{backgroundColor:this.props.backgroundColor,borderColor:this.props.borderColor,borderRadius:this.props.radius,width:this.props.radius,height:this.props.radius,position:"relative"}},this.props.children)}}]),t}(n.Component));b.defaultProps={backgroundColor:"transparent",borderColor:"#000",radius:"100px"};var k=b,C=(r(28),function(e){function t(e){var r;return Object(l.a)(this,t),(r=Object(p.a)(this,Object(h.a)(t).call(this,e))).handleClick=function(e){r.setState(function(t){var r=t.active.slice();if(r.includes(e)){var n=r.indexOf(e);r.splice(n,1)}else r.push(e),r.sort(function(e,t){return e-t});return Object(c.a)({},t,{active:r})})},r.audioContext=null,r.playing=!1,r.state=Object(c.a)({active:[]},e.initialState),r.playOrPause=r.playOrPause.bind(Object(v.a)(r)),r.scheduler=r.scheduler.bind(Object(v.a)(r)),r.bounce=i.a.createRef(),r.refCircle=i.a.createRef(),r}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.soundBuffer=this.soundLoader(this.props.sound.url)}},{key:"exportTrack",value:function(){var e=0,t=new y.a.Track;t.setTempo(this.props.bpm);for(var r=0;r<this.props.subdivisions;r++)this.state.active.includes(r)?(t.addEvent(new y.a.NoteEvent({channel:10,pitch:this.props.sound.instrument,duration:"16",wait:Array(e).fill("16")})),e=0):e+=1;return t}},{key:"soundLoader",value:function(e){var t=this,r={},n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){r.response=n.response},n.send(),r.play=function(e){var n=t.audioContext.createGain();n.gain.value=t.props.sound.volume;var i=t.audioContext.createBufferSource();i.buffer=r.soundToPlay,i.connect(n),n.connect(t.audioContext.destination),i.start(e)},r}},{key:"scheduler",value:function(){var e=this;for(window.requestAnimationFrame(function(){return e.updateBounce()});this.futureTickTime<this.audioContext.currentTime+.1;)this.playOrNot(),this.futureTick();this.timeout=window.setTimeout(this.scheduler,50)}},{key:"playOrNot",value:function(){var e=this;this.state.active.includes(this.current)&&(this.refCircle.current.setAttribute("class","pulse-anim"),window.setTimeout(function(){e.refCircle.current.setAttribute("class","")},100),this.soundBuffer.play(this.futureTickTime))}},{key:"preparePlay",value:function(){var e=this;this.props.sound&&!this.audioContext&&(this.audioContext=new AudioContext,this.audioContext.decodeAudioData(this.soundBuffer.response,function(t){e.soundBuffer.soundToPlay=t,e.soundBuffer.response=null}))}},{key:"playOrPause",value:function(){this.playing=!this.playing,this.startTickTime=this.audioContext.currentTime,this.playing?(this.current=0,this.futureTickTime=this.audioContext.currentTime,this.scheduler(),this.bounce.current.style.webkitAnimationPlayState="running"):(this.bounce.current.style.webkitAnimationPlayState="paused",this.updateBounce(),window.clearTimeout(this.timeout))}},{key:"updateBounce",value:function(){var e=this.pointCoords((this.audioContext.currentTime-this.startTickTime)*(this.props.bpm/15)%this.props.subdivisions);this.bounce.current.style.top=e.y+"px",this.bounce.current.style.left=e.x+"px"}},{key:"futureTick",value:function(){var e=60/this.props.bpm;this.futureTickTime+=.25*e,this.current=(this.current+1)%this.props.subdivisions}},{key:"pointCoords",value:function(e){var t=2*Math.PI/this.props.subdivisions*e;return{x:this.props.radius/2-2+Math.sin(t)*(this.props.radius+2)/2+10,y:this.props.radius-(this.props.radius/2-2+Math.cos(t)*(this.props.radius+2)/2)+5}}},{key:"render",value:function(){var e=this,t=[],r=this.state.active.slice();r.push(r[0]);for(var n=1;n<r.length;n++){var a=this.pointCoords(r[n]),s=this.pointCoords(r[n-1]);t.push(i.a.createElement("line",{key:"line"+n,x1:a.x,y1:a.y,x2:s.x,y2:s.y,stroke:"black",strokeWidth:"2"}))}var o=this.pointCoords(0);return i.a.createElement("div",{className:"Wheel",style:{padding:"10px"}},i.a.createElement("svg",{className:"beat-lines",style:{top:"5px",left:"5px"},width:this.props.radius+8,height:this.props.radius+8},t),i.a.createElement("div",{ref:this.bounce,className:"bounce",style:{top:o.y+"px",left:o.x+"px"}},i.a.createElement(k,{borderColor:"goldenrod",backgroundColor:"goldenrod",radius:"4px"})),i.a.createElement("div",{ref:this.refCircle},i.a.createElement(k,{borderColor:"white",radius:this.props.radius+"px"},Array.from({length:this.props.subdivisions},function(t,r){var n=e.pointCoords(r);return i.a.createElement("div",{key:"refCircle"+r,style:{cursor:"pointer",position:"absolute",top:n.y-10-3.2+"px",left:n.x-10-3+"px"},onClick:e.handleClick.bind(e,r)},i.a.createElement(k,{borderColor:"white",backgroundColor:"white",radius:"4px"}))}))),this.state.active.map(function(t){var r=e.pointCoords(t);return i.a.createElement("div",{key:"beatCircle"+t,style:{position:"absolute",top:r.y+"px",left:r.x+"px",pointerEvents:"none"}},i.a.createElement(k,{borderColor:"black",backgroundColor:"black",radius:"4px"}))}),i.a.createElement("div",{className:"name"},this.props.sound.name))}}]),t}(n.Component));C.defaultProps={subdivisions:16,radius:200};var x=C,w=(r(29),function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).handleExportClick=function(){var t=Object.keys(e.drums).map(function(t){return e.drums[t].current.exportTrack()}),r=new y.a.Writer(t);e.download("groove.mid",r.dataUri())},e.handlePlayClick=function(){e.setState(function(e){return Object(c.a)({},e,{playing:!e.playing})}),e.hasPlayed?e.play():(e.drums.crash.current.preparePlay(),e.drums.hihat.current.preparePlay(),e.drums.kick.current.preparePlay(),e.drums.snare.current.preparePlay(),window.setTimeout(e.play,100))},e.play=function(){e.hasPlayed=!0,e.drums.crash.current.playOrPause(),e.drums.hihat.current.playOrPause(),e.drums.kick.current.playOrPause(),e.drums.snare.current.playOrPause()},e.hasPlayed=!1,e.state={playing:!1},e.drums={crash:i.a.createRef(),hihat:i.a.createRef(),kick:i.a.createRef(),snare:i.a.createRef()},e}return Object(m.a)(t,e),Object(d.a)(t,[{key:"download",value:function(e,t){var r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},{key:"render",value:function(){return i.a.createElement("div",{className:"Player",style:{margin:"50px auto 0 auto",width:"1000px",textAlign:"center"}},i.a.createElement(x,{ref:this.drums.crash,initialState:{active:[0]},bpm:120,sound:{name:"Crash",volume:10,instrument:49,url:"/rhythm-wheel/sounds/crash.mp3"}}),i.a.createElement(x,{ref:this.drums.kick,initialState:{active:[0,8]},bpm:120,sound:{name:"Kick",volume:10,instrument:35,url:"/rhythm-wheel/sounds/kick.mp3"}}),i.a.createElement(x,{ref:this.drums.snare,initialState:{active:[4,12]},bpm:120,sound:{name:"Snare",volume:10,instrument:38,url:"/rhythm-wheel/sounds/snare.mp3"}}),i.a.createElement(x,{ref:this.drums.hihat,initialState:{active:[0,2,4,6,8,10,12,14,16]},bpm:120,sound:{name:"Hi-Hat",volume:8,instrument:42,url:"/rhythm-wheel/sounds/hat.mp3"}}),i.a.createElement("button",{onClick:this.handlePlayClick},this.state.playing?"Stop":"Play"),i.a.createElement("button",{onClick:this.handleExportClick},"Export"))}}]),t}(n.Component));var E=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(u.a,{href:"https://github.com/michaelmior/rhythm-wheel"}),i.a.createElement(w,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[13,1,2]]]);
//# sourceMappingURL=main.f033a429.chunk.js.map